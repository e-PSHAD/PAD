define("block_padplusvideocall/main",["exports","core/ajax","core/notification"],(function(_exports,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.setupVideoCallBlock=_exports.requestVideoCall=_exports.handleVideoCallRequest=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);var Selectors_DATA_CONTEXT="[data-contextid]",Selectors_INPUT_MODE="[name=videocall-mode]",Selectors_INPUT_MEETING_LINK="[data-input=meeting-link]",Selectors_CONTAINER_MODE_DIRECT="[data-container=videocall-mode-direct]",Selectors_CONTAINER_MODE_LINK="[data-container=videocall-mode-link]",Selectors_CONTAINER_LINK_INITIAL="[data-container=videocall-link-initial]",Selectors_CONTAINER_MEETING_LINK="[data-container=videocall-meeting-link]",Selectors_CONTAINER_COPY_SUCCESS="[data-container=videocall-copy-success]",Selectors_ACTION_REQUEST_LINK="[data-action=request-link]",Selectors_ACTION_RESET_LINK="[data-action=reset]",Selectors_ACTION_COPY_LINK="[data-action=copy]";_exports.setupVideoCallBlock=function(root){root.querySelectorAll(Selectors_INPUT_MODE).forEach((function(radio){var directVideoCallGroup=root.querySelector(Selectors_CONTAINER_MODE_DIRECT),linkVideoCallGroup=root.querySelector(Selectors_CONTAINER_MODE_LINK);radio.addEventListener("change",(function(event){"direct"===event.target.value?toggleDisplay(linkVideoCallGroup,directVideoCallGroup):toggleDisplay(directVideoCallGroup,linkVideoCallGroup)}))})),function(root){var videocallform=root.querySelector(Selectors_CONTAINER_MODE_DIRECT).querySelector("form");videocallform.querySelector("input[type=submit]").addEventListener("click",(function(e){var viewersid=new FormData(videocallform).getAll("videocallviewers[]"),launchvideocallurl=videocallform.getAttribute("action");requestVideoCall(e,launchvideocallurl,viewersid)}))}(root),function(root){var initialRequestContainer=root.querySelector(Selectors_CONTAINER_LINK_INITIAL),meetingLinkContainer=root.querySelector(Selectors_CONTAINER_MEETING_LINK),meetingLinkInput=root.querySelector(Selectors_INPUT_MEETING_LINK);root.querySelector(Selectors_ACTION_REQUEST_LINK).addEventListener("click",(function(){var contextid=root.querySelector(Selectors_DATA_CONTEXT).getAttribute("data-contextid");return toggleDisplay(meetingLinkContainer),function(contextid){return _ajax.default.call([{methodname:"block_padplusvideocall_generate_meeting_link",args:{contextid:contextid}}])[0].then((function(data){return data.meetingurl}))}(contextid).then((function(meetingurl){meetingLinkInput.setAttribute("value",meetingurl),toggleDisplay(initialRequestContainer,meetingLinkContainer)})).catch(_notification.default.exception)})),root.querySelector(Selectors_ACTION_RESET_LINK).addEventListener("click",(function(){toggleDisplay(meetingLinkContainer,initialRequestContainer),meetingLinkInput.setAttribute("value",""),toggleDisplay(root.querySelector(Selectors_CONTAINER_MODE_LINK)),root.querySelector(Selectors_INPUT_MODE+"[value=link]").checked=!1}));var successContainer=root.querySelector(Selectors_CONTAINER_COPY_SUCCESS);root.querySelector(Selectors_ACTION_COPY_LINK).addEventListener("click",(function(){navigator.clipboard.writeText(meetingLinkInput.value),toggleDisplay(meetingLinkInput,successContainer),setTimeout((function(){toggleDisplay(successContainer,meetingLinkInput)}),1200)}))}(root)};_exports.handleVideoCallRequest=function(buttonId){var button=document.getElementById(buttonId);button.addEventListener("click",(function(e){var launchvideocallurl=button.getAttribute("href");requestVideoCall(e,launchvideocallurl)}))};var requestVideoCall=function(e,launchvideocallurl,viewersid,meetingname){if(e.preventDefault(),viewersid){var viewersparam=viewersid.join(",");launchvideocallurl="".concat(launchvideocallurl,"&viewersid=").concat(viewersparam)}meetingname&&(launchvideocallurl="".concat(launchvideocallurl,"&name=").concat(meetingname)),window.open(launchvideocallurl)};function toggleDisplay(elementToHide){var elementToShow=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;elementToHide.classList.add("hidden"),elementToShow&&elementToShow.classList.remove("hidden")}_exports.requestVideoCall=requestVideoCall}));

//# sourceMappingURL=main.min.js.map