{"version":3,"file":"mycourses_main.min.js","sources":["../src/mycourses_main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Custom initialisation for the myoverview block on my-courses page.\n *\n * This effectively decouples this view from user preferences on dashboard.\n * - set custom start configuration so that user always falls back on the same view by default\n * - do no save user choices as preferences so as to not impact dashboard view\n *\n * Note this happens at runtime, so user may still catch a glimpse of its dashboard preferences\n * set in the backend generated template before the script replaces them.\n */\n\n define(\n    [\n        'jquery',\n        'core/custom_interaction_events',\n        'block_myoverview/selectors',\n        'block_myoverview/view',\n        'local_padplusextensions/mycourses_nav'\n    ],\n    function(\n        $,\n        CustomEvents,\n        Selectors,\n        View,\n        MyCoursesNav\n    ) {\n        /**\n         * Custom start configuration for the overview block.\n         */\n        const MYCOURSES_CONFIG = {\n            grouping: 'allincludinghidden', // BLOCK_MYOVERVIEW_GROUPING_ALLINCLUDINGHIDDEN\n            sort: 'ul.timeaccess desc', // Data-value for lastaccessed criteria (see nav-sort-selector.mustache)\n            display: 'card', // BLOCK_MYOVERVIEW_VIEW_CARD\n            paging: 12 // BLOCK_MYOVERVIEW_PAGING_12\n        };\n\n        /**\n         * Initialise all of the modules for the overview block.\n         *\n         * @param {object} root The root element for the overview block.\n         */\n        var init = function(root) {\n            root = $(root);\n            // Override user preferences with start configuration for the courses-view component\n            const dataRegion = root.find(Selectors.courseView.region);\n            for (const [filter, value] of Object.entries(MYCOURSES_CONFIG)) {\n                dataRegion.attr('data-' + filter, value);\n            }\n\n            // Proceed with component initialization.\n            // Quirks: use setTimeout to delay initialization until next cycle.\n            // Otherwise dropdown listeners are not triggered (presumable because not yet installed in current cycle).\n            setTimeout(() => {\n                // Filter and display select boxes are built on backend with user preferences.\n                // We trigger start items to mirror the start configuration at runtime.\n                const groupingStartItem =\n                    root.find(`${MyCoursesNav.Selectors.FILTER_OPTION}[data-value=${MYCOURSES_CONFIG.grouping}]`);\n                $(groupingStartItem).trigger(CustomEvents.events.activate);\n                const displayStartItem =\n                    root.find(`${MyCoursesNav.Selectors.DISPLAY_OPTION}[data-value=${MYCOURSES_CONFIG.display}]`);\n                $(displayStartItem).trigger(CustomEvents.events.activate);\n\n                // Initialise the course navigation elements.\n                MyCoursesNav.init(root);\n                // Initialise the courses view modules.\n                View.init(root);\n            });\n        };\n\n        return {\n            init: init\n        };\n    });\n"],"names":["define","$","CustomEvents","Selectors","View","MyCoursesNav","MYCOURSES_CONFIG","grouping","sort","display","paging","init","root","dataRegion","find","courseView","region","Object","entries","filter","value","attr","setTimeout","groupingStartItem","FILTER_OPTION","trigger","events","activate","displayStartItem","DISPLAY_OPTION"],"mappings":"qnCA0BCA,gDACG,CACI,SACA,iCACA,6BACA,wBACA,0CAEJ,SACIC,EACAC,aACAC,UACAC,KACAC,kBAKMC,iBAAmB,CACrBC,SAAU,qBACVC,KAAM,qBACNC,QAAS,OACTC,OAAQ,UAoCL,CACHC,KA7BO,SAASC,cAGVC,YAFND,KAAOX,EAAEW,OAEeE,KAAKX,UAAUY,WAAWC,6BACpBC,OAAOC,QAAQZ,iDAAmB,8DAApDa,6BAAQC,4BAChBP,WAAWQ,KAAK,QAAUF,OAAQC,OAMtCE,YAAW,eAGDC,kBACFX,KAAKE,eAAQT,aAAaF,UAAUqB,qCAA4BlB,iBAAiBC,eACrFN,EAAEsB,mBAAmBE,QAAQvB,aAAawB,OAAOC,cAC3CC,iBACFhB,KAAKE,eAAQT,aAAaF,UAAU0B,sCAA6BvB,iBAAiBG,cACtFR,EAAE2B,kBAAkBH,QAAQvB,aAAawB,OAAOC,UAGhDtB,aAAaM,KAAKC,MAElBR,KAAKO,KAAKC"}